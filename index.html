<!DOCTYPE html>
<html>
  <head>
    <script src="https://aloycwl.github.io/js/cdn/jquery.min.js"></script>
    <script src="https://aloycwl.github.io/js/cdn/web3.min.js"></script>
    <script src="https://aloycwl.github.io/js/cdn/web3ac.js"></script>
  </head>
  <body>
    <button id="connect" onclick="start()">Connect</button>
    <i id="loading"></i>
    <br /><br />
    <div id="root">
      <button onclick="changeNum(-1)">-</button>
      <button id="mintBtn" onclick="mint()">Mint 1</button>
      <button onclick="changeNum(1)">+</button>
    </div>
    <br /><br />
    <div id="nfts" class=""></div>
  </body>
  <script>
    $.getScript('js/generative.js', function () {});
    $.getScript(
      'https://aloycwl.github.io/js/cdn/ipfs-api.min.js',
      function () {}
    );
    num = 1;
    CHAIN = 4;
    CS = 'https://aloycwl.github.io/lsg_frontend/css/lsg.css';
    function changeNum(n) {
      num += n;
      num = num < 1 ? 5 : num > 5 ? 1 : num;
      $('#mintBtn').html('Mint ' + num);
    }
    async function mint() {
      $('#nfts').html('');
      $('#loading').html('Fetching number...');
      cnt = 0;
      count = await contract.count().call();
      ipfs = IpfsApi(IA);
      cidImg = new Array();
      $('#loading').html('Generating art...');
      for (i = count; i < Number(count) + Number(num); i++) {
        await drawLCA(i);
        cidImg.push(
          await uploadJson(
            `{"name":"LCA #${i}","description":"Haha to those who have invested in LUNA","image":"ipfs://${await uploadImg(
              i
            )}",${txt}}`
          )
        );
      }
      $('#loading').html('Minting...');
      await contract.MINT(cidImg).send(FA);
      $('#loading').html('Congratulation!');
      $('#nfts').show();
    }
    async function start() {
      await load(
        [
          {
            inputs: [u6],
            name: 'MINT',
            outputs: [],
            stateMutability: 'nonpayable',
            type: 'function',
          },
          {
            inputs: [],
            name: 'count',
            outputs: [u1],
            stateMutability: 'view',
            type: 'function',
          },
        ],
        '0xF965957d44431CcDd9afFD0F5d6e9aE524FECb9b'
      );
      loaded = 1;
    }
    start();

    $(document).ready(function () {
      setInterval(async function () {
        if (typeof ethereum != 'undefined') {
          d = await web3.getAccounts();
          if (d.length > 0) {
            $('#connect').hide();
            $('#root').show();
            if (loaded < 1) start();
          } else {
            $('#connect').show();
            $('#root').hide();
          }
        }
      }, 1000);
    });
  </script>
</html>
